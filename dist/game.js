(function(){"use strict";var un=window;function N(){document.body.oncontextmenu=function(n){n.preventDefault()}}function R(){N()}function U(n){const e={type:Phaser.AUTO,width:1080,height:1920,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},backgroundColor:"#4eaefc",scene:n};return new Phaser.Game(e)}const D=Phaser.Scene,r=Phaser.Math.Vector2;var k;(function(n){n[n.Playing=0]="Playing",n[n.GameEnd=1]="GameEnd"})(k||(k={}));let b,I,g,P;const l=new r(10,10),C=new r(10,10),x=new r(85,85),T=x.clone().add(C),v=15;let H=l.x*l.y-v;const A=16777215,W=26367,X=5277951;let w=null,h=null,p=()=>{},F=[],s=[],M=[],c=[],y=[];class Y extends D{constructor(){super("Minesweeper")}preload(){b=this.cameras.main,I=()=>new r(b.centerX,b.centerY),g=this.add.container(I().x,I().y),P=this.add.container(0,0),q(),J()}create(){const e=Z(this),t=$(this),o=z(this),a=nn(this),i=en(this);g.add(e),g.add(t),g.add(a),g.add(i),g.add(o),g.add(P),cn(this)}}function B(n){let e=new r(-1,-1);return e.y=Math.floor(n/l.x),e.x=n-e.y*l.x,e}function u(n){return n.x<0||n.y<0||n.x>=l.x||n.y>=l.y?-1:l.x*n.y+n.x}function O(n,e,t){const o=(t.x-t.x*e.x)*.5,a=(t.y-t.y*e.y)*.5;let i=o,d=a,f=0,m=0;for(let L of n)if(L!=null){if(L.setPosition(i,d),f<e.x-1){f+=1,i+=t.x;continue}m<e.y-1&&(f=0,i=o,m+=1,d+=t.y)}}function j(n){var e=[];for(let i=0;i<l.x*l.y;i++)e.push(i);let t=e.length,o=0,a=0;for(;t!=0;)a=Math.floor(Math.random()*t),t--,o=e[t],e[t]=e[a],e[a]=o;return e.slice(0,n)}function q(){for(let n=0;n<l.x*l.y;n++)c.push(0)}function J(){for(let n=0;n<l.x*l.y;n++)y.push(null)}function S(){for(let n of s)n==null||n.getAll().forEach(e=>{e&&(e.alpha!=0&&e.setAlpha(.5),e.removeInteractive())})}function K(){console.log("Game Win!"),S()}function Q(){console.log("Game Lose!"),S()}function Z(n){return n.add.rectangle(0,0,l.x*T.x+C.x,l.y*T.y+C.y,X)}function $(n){for(let e=0;e<l.x*l.y;e++)F.push(tn(n,x));return O(F,l,T),n.add.container(0,0,F)}function z(n){for(let e=0;e<l.x*l.y;e++)s.push(on(n,x,C,e));return O(s,l,T),n.add.container(0,0,s)}function nn(n){for(let e of j(v)){const t=ln(n,x.clone().divide(new r(2,2))).setPosition(s[e].x,s[e].y);M.push(t),c[e]=10;const o=B(e),a=o.x+1<l.x,i=o.x-1>=0,d=o.y+1<l.y,f=o.y-1>=0;a&&(c[u(o.clone().add(new r(1,0)))]+=1),i&&(c[u(o.clone().add(new r(-1,0)))]+=1),d&&(c[u(o.clone().add(new r(0,1)))]+=1),f&&(c[u(o.clone().add(new r(0,-1)))]+=1),d&&a&&(c[u(o.clone().add(new r(1,1)))]+=1),d&&i&&(c[u(o.clone().add(new r(-1,1)))]+=1),f&&a&&(c[u(o.clone().add(new r(1,-1)))]+=1),f&&i&&(c[u(o.clone().add(new r(-1,-1)))]+=1)}return n.add.container(0,0,M)}function en(n){const e=[];for(let t=0;t<l.x*l.y;t++){if(c[t]==0||c[t]>=10)continue;const o=n.add.text(s[t].x,s[t].y,c[t].toString());o.setOrigin(.5),o.setFontSize(x.y*.43),o.setFontStyle("Bold"),e.push(o)}return n.add.container(0,0,e)}function tn(n,e){return n.add.rectangle(0,0,e.x,e.y,16777215,.3)}function on(n,e,t,o){const a=n.add.rectangle(0,0,e.x,e.y,A),i=n.add.rectangle(0,0,e.x+t.x,e.y+t.y,5592575,0).setInteractive(),d=n.add.container(0,0,[a,i]);function f(){i.setFillStyle(i.fillColor,.3)}function m(){i.setFillStyle(i.fillColor,0)}return i.on("pointerover",f),i.on("pointerout",m),n.input.on("gameout",m),an(n,i,a,o),d}function ln(n,e){const t=n.add.text(0,0,"\u{1F4A3}");return t.setOrigin(.5),t.setPadding(20),t.setFontSize(x.y*.65),t}function rn(n){const e=n.add.text(0,0,"\u{1F6A9}");return e.setOrigin(.5),e.setPadding(20),e.setFontSize(x.y*.65),P.add(e),e}function V(n){n.forEach(e=>{e.destroy()}),--H==0&&K()}function E(n){y[u(n)]!=null&&(y[u(n)].destroy(),y[u(n)]=null)}function G(n){const e=s[u(n)].getAll();e.length!=0&&(V(e),E(n))}function _(n){const e=s[u(n)].getAll();if(e.length==0)return;V(e),E(n);function t(f){c[u(f)]==0?_(f):c[u(f)]<10&&G(f)}const o=n.x+1<l.x,a=n.x-1>=0,i=n.y+1<l.y,d=n.y-1>=0;o&&t(n.clone().add(new r(1,0))),a&&t(n.clone().add(new r(-1,0))),i&&t(n.clone().add(new r(0,1))),d&&t(n.clone().add(new r(0,-1))),i&&o&&t(n.clone().add(new r(1,1))),i&&a&&t(n.clone().add(new r(-1,1))),d&&o&&t(n.clone().add(new r(1,-1))),d&&a&&t(n.clone().add(new r(-1,-1)))}function an(n,e,t,o){function a(){y[o]||(w=e,h=t,h.setFillStyle(W),p=()=>{c[o]>9?(Q(),G(B(o))):_(B(o))})}function i(){w||(y[o]?(y[o].destroy(),y[o]=null):(y[o]=rn(n),y[o].setPosition(s[o].x,s[o].y)))}e.on("pointerdown",d=>{switch(d.button){case 0:a();break;case 2:i();break}})}function cn(n){function e(){!w||(h.setFillStyle(A),h=null,w=null,p=()=>{})}n.input.on("gameout",e),n.input.on("pointerup",t=>{t.button==0&&e()}),n.input.on("gameobjectup",(t,o)=>{t.button==0&&(o==w&&p(),h!=null&&(h.setFillStyle(A),h=null),w=null,p=()=>{})})}R(),U(new Y)})();
